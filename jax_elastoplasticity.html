
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>JAX implementation of elastoplasticity &#8212; dolfinx_materials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'jax_elastoplasticity';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Computing the Hosford plane stress yield surface" href="demos/elastoplasticity/Hosford_yield_surface.html" />
    <link rel="prev" title="JAX implementation of material behaviors" href="jax.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">dolfinx_materials</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Documentation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">General framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="jax.html">JAX implementation of material behaviors</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">JAX demos</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">JAX implementation of elastoplasticity</a></li>
<li class="toctree-l1"><a class="reference internal" href="demos/elastoplasticity/Hosford_yield_surface.html">Computing the Hosford plane stress yield surface</a></li>
<li class="toctree-l1"><a class="reference internal" href="demos/elastoplasticity/plane_elastoplasticity.html">Finite-element simulations of JAX elastoplasticity</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MFront demos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="demos/mfront/heat_transfer/nonlinear_heat_transfer.html">Stationary nonlinear heat transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="demos/mfront/heat_transfer/phase_change.html">Transient heat equation with phase change</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="api/material.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">material</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="api/quadrature_map.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">quadrature_map</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="api/solvers.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">solvers</span></code></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>JAX implementation of elastoplasticity</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#von-mises-plasticity-with-isotropic-hardening">von Mises plasticity with isotropic hardening</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elastoplastic-evolution-equations">Elastoplastic evolution equations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#return-mapping-procedure">Return mapping procedure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jax-implementation">JAX implementation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generic-elastoplasticity-with-isotropic-hardening">Generic elastoplasticity with isotropic hardening</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="jax-implementation-of-elastoplasticity">
<h1>JAX implementation of elastoplasticity<a class="headerlink" href="#jax-implementation-of-elastoplasticity" title="Link to this heading">#</a></h1>
<p>To go further in the implementation of complex behaviors using JAX, we now describe the implementation of elastoplastic behaviors. <span class="math notranslate nohighlight">\(\newcommand{\bsig}{\boldsymbol{\sigma}}
\newcommand{\beps}{\boldsymbol{\varepsilon}}
\newcommand{\bI}{\boldsymbol{I}}
\newcommand{\bn}{\boldsymbol{n}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\bepsp}{\boldsymbol{\varepsilon}^\text{p}}
\newcommand{\dev}{\operatorname{dev}}
\newcommand{\tr}{\operatorname{tr}}
\newcommand{\sigeq}{\sigma_\text{eq}}
\newcommand{\bnel}{\boldsymbol{n}_\text{elas}}
\newcommand{\bs}{\boldsymbol{s}}\)</span></p>
<section id="von-mises-plasticity-with-isotropic-hardening">
<h2>von Mises plasticity with isotropic hardening<a class="headerlink" href="#von-mises-plasticity-with-isotropic-hardening" title="Link to this heading">#</a></h2>
<p>We first consider the case of von Mises elastoplasticity with a general nonlinear isotropic hardening. The corresponding evolution equations are recalled here.</p>
<section id="elastoplastic-evolution-equations">
<h3>Elastoplastic evolution equations<a class="headerlink" href="#elastoplastic-evolution-equations" title="Link to this heading">#</a></h3>
<p>The state variables consist here of the plastic strain <span class="math notranslate nohighlight">\(\bepsp\)</span> and the cumulated equivalent plastic strain <span class="math notranslate nohighlight">\(p\)</span> which is such that <span class="math notranslate nohighlight">\(\dot{p} = \sqrt{\frac{2}{3}}\|\dot{\beps}^\text{p}\|\)</span>.</p>
<p>The elastic behavior is linear isotropic:</p>
<div class="math notranslate nohighlight">
\[\bsig = \lambda \tr(\beps-\bepsp)\bI + 2\mu(\beps-\bepsp) = \CC:(\beps-\bepsp)\]</div>
<p>The yield condition is given by:</p>
<div class="math notranslate nohighlight">
\[f(\bsig;p) = \sqrt{\frac{3}{2}\boldsymbol{s}:\boldsymbol{s}} - R(p) \leq 0\]</div>
<p>where <span class="math notranslate nohighlight">\(\bs = \dev(\bsig)\)</span> is the deviatoric stress and <span class="math notranslate nohighlight">\(R(p)\)</span> is the yield strength. We also introduce the von Mises equivalent stress:</p>
<div class="math notranslate nohighlight">
\[\sigeq =  \sqrt{\frac{3}{2}\boldsymbol{s}:\boldsymbol{s}}\]</div>
<p>Plastic evolution is given by the associated flow rule:</p>
<div class="math notranslate nohighlight">
\[\dot{\beps}^\text{p} = \dot{\lambda}\dfrac{\partial f}{\partial \bsig}\]</div>
<p>which gives in the present case:</p>
<div class="math notranslate nohighlight" id="equation-flow-rule">
<span class="eqno">(5)<a class="headerlink" href="#equation-flow-rule" title="Link to this equation">#</a></span>\[\dot{\beps}^\text{p} = \dot{p}\dfrac{3}{2\sigeq}\bs\]</div>
</section>
<section id="return-mapping-procedure">
<h3>Return mapping procedure<a class="headerlink" href="#return-mapping-procedure" title="Link to this heading">#</a></h3>
<p>The return mapping procedure is a predictor-corrector algorithm which consists in finding a new stress <span class="math notranslate nohighlight">\(\bsig_{n+1}\)</span> and plastic strain <span class="math notranslate nohighlight">\(p_{n+1}\)</span> state verifying the current plasticity condition from a previous stress <span class="math notranslate nohighlight">\(\bsig_{n}\)</span> and internal variable <span class="math notranslate nohighlight">\(p_n\)</span> state and an increment of total deformation <span class="math notranslate nohighlight">\(\Delta \beps\)</span>. This step is quite classical in FEM plasticity for a von Mises criterion with isotropic hardening and follows notations from <span id="id1">[]</span>.</p>
<p>In the case of plastic flow, the flow rule <a class="reference internal" href="#equation-flow-rule">(5)</a> is approximated at <span class="math notranslate nohighlight">\(t_{n+1}\)</span> using a backward-Euler approximation:</p>
<div class="math notranslate nohighlight" id="equation-flow-rule-incr">
<span class="eqno">(6)<a class="headerlink" href="#equation-flow-rule-incr" title="Link to this equation">#</a></span>\[\Delta \bepsp = \Delta p \dfrac{3}{2\sigma_{\text{eq},n+1}}\bs_{n+1}\]</div>
<p>An elastic trial stress <span class="math notranslate nohighlight">\(\bsig_{\text{elas}} = \bsig_{n} + \CC:\Delta \beps\)</span> is first computed. The plasticity criterion is then evaluated with the previous plastic strain <span class="math notranslate nohighlight">\(f_{\text{elas}} = \sigeq^{\text{elas}} - R(p_n)\)</span> where <span class="math notranslate nohighlight">\(\sigeq^{\text{elas}}\)</span> is the von Mises equivalent stress of the elastic trial stress.</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(f_{\text{elas}} &lt; 0\)</span>, no plasticity occurs during this time increment and <span class="math notranslate nohighlight">\(\Delta p,\Delta  \boldsymbol{\varepsilon}^p =0\)</span> and <span class="math notranslate nohighlight">\(\bsig_{n+1} = \bsig_\text{elas}\)</span>.</p></li>
<li><p>Otherwise, plasticity occurs and the increment of plastic strain <span class="math notranslate nohighlight">\(\Delta p\)</span> is such that:</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-plastic-ev-discr">
<span class="eqno">(7)<a class="headerlink" href="#equation-plastic-ev-discr" title="Link to this equation">#</a></span>\[\begin{split}\begin{align}
\bsig_{n+1} &amp;= \bsig_\text{elas} - 2\mu\Delta \bepsp\\
\Delta \bepsp &amp;= \Delta p \dfrac{3}{2\sigma_{\text{eq},n+1}}\bs_{n+1}\\
f(\bsig_{n+1}) &amp;= \sigma_{\text{eq},n+1} - R(p_n +\Delta p) = 0\\
\end{align}\end{split}\]</div>
<p>Taking the deviatoric part of the first equation and injecting in the second shows that:</p>
<div class="math notranslate nohighlight">
\[
\left(1+\dfrac{3\mu\Delta p}{\sigma_{\text{eq},n+1}}\right)\bs_{n+1} = \bs_\text{elas}
\]</div>
<p>which results in:</p>
<div class="math notranslate nohighlight">
\[
\sigma_{\text{eq},n+1} = \sigeq^\text{elas} - 3\mu \Delta p
\]</div>
<p>This relation is specific to the case of elastic isotropy and von Mises yield surface. It does not hold for more general cases. Importantly, it allows to express the plastic strain increment explicitly as a function of the equivalent plastic strain increment:</p>
<div class="math notranslate nohighlight">
\[
\Delta \bepsp = \Delta p \dfrac{3}{2\sigma_{\text{eq},n+1}}\bs_{n+1} = \Delta p \dfrac{3}{2\sigeq^\text{elas}}\bs_\text{elas}
\]</div>
<p>The only remaining unknown is <span class="math notranslate nohighlight">\(\Delta p\)</span> which is deducing from the third equation of <a class="reference internal" href="#equation-plastic-ev-discr">(7)</a>:</p>
<div class="math notranslate nohighlight">
\[
\sigeq^\text{elas} - 3\mu\Delta p -R(p_n+\Delta p)=0
\]</div>
</section>
<section id="jax-implementation">
<h3>JAX implementation<a class="headerlink" href="#jax-implementation" title="Link to this heading">#</a></h3>
<p>To summarize, the JAX implementation will involve the following steps:</p>
<ul class="simple">
<li><p>computing an elastic stress predictor</p></li>
<li><p>checking wether the yield criterion is exceeded or not</p></li>
<li><p>setting <span class="math notranslate nohighlight">\(\Delta p,\Delta_\bepsp=0\)</span> if it is not attained</p></li>
<li><p>otherwise, solving a nonlinear equation for <span class="math notranslate nohighlight">\(\Delta p\)</span> and setting <span class="math notranslate nohighlight">\(\Delta \bepsp\)</span> accordingly</p></li>
</ul>
<p>One key challenge here is the use of conditionals to distinguish elastic and plastic evolutions. Moreover, we will use the <code class="docutils literal notranslate"><span class="pre">tangent_AD</span></code> decorator to compute the tangent operator via AutoDiff.</p>
<p>First, we load the necessary modules and functions. The <code class="docutils literal notranslate"><span class="pre">vonMisesIsotropicMaterial</span></code> takes as input a <code class="docutils literal notranslate"><span class="pre">LinearElasticModel</span></code> for the elastic part and a function <code class="docutils literal notranslate"><span class="pre">yield_stress</span></code> representing <span class="math notranslate nohighlight">\(R(p)\)</span>. We use the <code class="docutils literal notranslate"><span class="pre">dev</span></code> function from <code class="docutils literal notranslate"><span class="pre">tensors</span></code> to compute the deviatoric part of a 2nd-rank symmetric tensor. Finally, we declare the scalar equivalent strain <span class="math notranslate nohighlight">\(p\)</span> as an internal state variables for this behavior.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">from</span> <span class="nn">dolfinx_materials.material.jax</span> <span class="kn">import</span> <span class="n">JAXMaterial</span><span class="p">,</span> <span class="n">tangent_AD</span><span class="p">,</span> <span class="n">JAXNewton</span>
<span class="kn">from</span> <span class="nn">.tensors</span> <span class="kn">import</span> <span class="n">dev</span>

<span class="k">class</span> <span class="nc">vonMisesIsotropicHardening</span><span class="p">(</span><span class="n">JAXMaterial</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elastic_model</span><span class="p">,</span> <span class="n">yield_stress</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elastic_model</span> <span class="o">=</span> <span class="n">elastic_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yield_stress</span> <span class="o">=</span> <span class="n">yield_stress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equivalent_norm</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sig</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dev</span><span class="p">(</span><span class="n">sig</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">internal_state_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since we restrict here to isotropic hardening, we do not need to store the history of <span class="math notranslate nohighlight">\(\bepsp\)</span> in the state variables.</p>
</div>
<p>In a second step, we implement the constitutive update, decorated with <code class="docutils literal notranslate"><span class="pre">tangent_AD</span></code>. The function must therefore provide the stress and the state as output and accepts the current strain <code class="docutils literal notranslate"><span class="pre">eps</span></code>, the previous state <code class="docutils literal notranslate"><span class="pre">state</span></code> and the time step as inputs.</p>
<p>First, we retrieve the relevant state variables and we compute the elastic predictor stress <code class="docutils literal notranslate"><span class="pre">sig_el</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@tangent_AD</span>
    <span class="k">def</span> <span class="nf">constitutive_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="n">eps_old</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;Strain&quot;</span><span class="p">]</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="n">eps</span> <span class="o">-</span> <span class="n">eps_old</span>
        <span class="n">p_old</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># convert to scalar</span>
        <span class="n">sig_old</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;Stress&quot;</span><span class="p">]</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elastic_model</span><span class="o">.</span><span class="n">mu</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elastic_model</span><span class="o">.</span><span class="n">C</span>
        <span class="n">sig_el</span> <span class="o">=</span> <span class="n">sig_old</span> <span class="o">+</span> <span class="n">C</span> <span class="o">@</span> <span class="n">deps</span>
</pre></div>
</div>
<p>We then evaluate the yield criterion for the elastic predictor. We also define the vector <span class="math notranslate nohighlight">\(\bnel=\bs_\text{elas}/\sigeq^\text{elas}\)</span> which, for this specific case, is normal to the yield surface. Note that we clip the value of the equivalent stress to avoid dividing by zero.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">sig_Y_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yield_stress</span><span class="p">(</span><span class="n">p_old</span><span class="p">)</span>
        <span class="n">sig_eq_el</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equivalent_norm</span><span class="p">(</span><span class="n">sig_el</span><span class="p">),</span> <span class="n">a_min</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
        <span class="n">n_el</span> <span class="o">=</span> <span class="n">dev</span><span class="p">(</span><span class="n">sig_el</span><span class="p">)</span> <span class="o">/</span> <span class="n">sig_eq_el</span>
        <span class="n">yield_criterion</span> <span class="o">=</span> <span class="n">sig_eq_el</span> <span class="o">-</span> <span class="n">sig_Y_old</span>
</pre></div>
</div>
<p>We now define the value of the plastic strain increment as a function of the equivalent plastic strain increment <span class="math notranslate nohighlight">\(\Delta p\)</span> which is still unknown. We use <code class="docutils literal notranslate"><span class="pre">jax.lax.cond</span></code> control flow primitive to express the <code class="docutils literal notranslate"><span class="pre">if/else</span></code> condition, switching between elastic and plastic evolutions. The advantage of <code class="docutils literal notranslate"><span class="pre">jax.lax.cond</span></code> is that we can still use JIT and forward/backward differentiation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="k">def</span> <span class="nf">deps_p</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">yield_criterion</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">deps_p_elastic</span><span class="p">(</span><span class="n">dp</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">deps_p_plastic</span><span class="p">(</span><span class="n">dp</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_el</span> <span class="o">*</span> <span class="n">dp</span> 

            <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
                <span class="n">yield_criterion</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="n">deps_p_elastic</span><span class="p">,</span>
                <span class="n">deps_p_plastic</span><span class="p">,</span>
                <span class="n">dp</span><span class="p">,</span>
            <span class="p">)</span>
</pre></div>
</div>
<p>We now define the nonlinear function <span class="math notranslate nohighlight">\(r(\Delta p)=0\)</span> which should be solved to compute <span class="math notranslate nohighlight">\(\Delta p\)</span>. We still use <code class="docutils literal notranslate"><span class="pre">jax.lax.cond</span></code> and use the trivial function <span class="math notranslate nohighlight">\(r(\Delta p)=\Delta p\)</span> for the elastic case, yielding <span class="math notranslate nohighlight">\(\Delta p=0\)</span>. Then, we solve this nonlinear function using a custom <code class="docutils literal notranslate"><span class="pre">JAXNewton</span></code> solver. The latter implements a local Newton method and uses AD to compute the corresponding jacobian. Finally, it is also fully differentiable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="n">dp</span><span class="p">):</span>
            <span class="n">r_elastic</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dp</span><span class="p">:</span> <span class="n">dp</span>
            <span class="n">r_plastic</span> <span class="o">=</span> <span class="p">(</span>
                <span class="k">lambda</span> <span class="n">dp</span><span class="p">:</span> <span class="n">sig_eq_el</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yield_stress</span><span class="p">(</span><span class="n">p_old</span> <span class="o">+</span> <span class="n">dp</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">yield_criterion</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">r_elastic</span><span class="p">,</span> <span class="n">r_plastic</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>


        <span class="n">newton</span> <span class="o">=</span> <span class="n">JAXNewton</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">dp</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">newton</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Once <span class="math notranslate nohighlight">\(\Delta p\)</span> has been solved for, we compute the final stress and update the corresponding state dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">sig</span> <span class="o">=</span> <span class="n">sig_el</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">deps_p</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">yield_criterion</span><span class="p">)</span>

        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;Strain&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deps</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dp</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;Stress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span>
        <span class="k">return</span> <span class="n">sig</span><span class="p">,</span> <span class="n">state</span>
</pre></div>
</div>
<p>Simulating this behavior for a loading/unloading shear strain with an exponential harding law results in the following stress/strain curve.</p>
<a class="reference internal image-reference" href="_images/elastoplastic_shear_1d.svg"><img alt="_images/elastoplastic_shear_1d.svg" class="align-center" src="_images/elastoplastic_shear_1d.svg" width="500px" /></a>
</section>
</section>
<section id="generic-elastoplasticity-with-isotropic-hardening">
<h2>Generic elastoplasticity with isotropic hardening<a class="headerlink" href="#generic-elastoplasticity-with-isotropic-hardening" title="Link to this heading">#</a></h2>
<p>In this section, we expand upon the previous section by considering a generic yield surface <span class="math notranslate nohighlight">\(f(\bsig;p) = \bar{\sigma}(\bsig) - R(p)\)</span> instead of the specific von Mises surface. Here <span class="math notranslate nohighlight">\(\bar{\sigma}\)</span> represents a chosen equivalent stress. For simplicity, we still consider a generic isotropic hardening function <span class="math notranslate nohighlight">\(R(p)\)</span> and associated (normal) plastic flow rule. In discretized form, the latter reads:</p>
<div class="math notranslate nohighlight">
\[
\Delta \bepsp = \Delta p \dfrac{\partial \bsig}{\partial \bsig} = \Delta p \bn
\]</div>
<p>where <span class="math notranslate nohighlight">\(\bn\)</span> denotes the normal vector to the yield surface. This vector depends on the final stress state <span class="math notranslate nohighlight">\(\bsig\)</span>. This is the main difference with the von Mises case. As a consequence, the return mapping can no longer be written explicitly in terms of the elastic predictor. We must formulate a nonlinear system of equations involving both the cumulated plastic strain <span class="math notranslate nohighlight">\(p\)</span> and the plastic strain tensor <span class="math notranslate nohighlight">\(\bepsp\)</span>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">GeneralIsotropicHardening</span></code> class now depends on an elastic model, a yield stress function and a function implementing the chosen equivalent stress <span class="math notranslate nohighlight">\(\bar{\sigma}(\bsig)\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">from</span> <span class="nn">dolfinx_materials.material.jax</span> <span class="kn">import</span> <span class="n">JAXMaterial</span><span class="p">,</span> <span class="n">tangent_AD</span><span class="p">,</span> <span class="n">JAXNewton</span>

<span class="k">class</span> <span class="nc">GeneralIsotropicHardening</span><span class="p">(</span><span class="n">JAXMaterial</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elastic_model</span><span class="p">,</span> <span class="n">yield_stress</span><span class="p">,</span> <span class="n">equivalent_stress</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elastic_model</span> <span class="o">=</span> <span class="n">elastic_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yield_stress</span> <span class="o">=</span> <span class="n">yield_stress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equivalent_stress</span> <span class="o">=</span> <span class="n">equivalent_stress</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">internal_state_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p>As before, we implement the constitutive update, decorated with <code class="docutils literal notranslate"><span class="pre">tangent_AD</span></code>. We first retrieve the relevant state variables and we compute the elastic predictor stress <code class="docutils literal notranslate"><span class="pre">sig_el</span></code>, the elastic equivalent stress <span class="math notranslate nohighlight">\(\bar(\bsig_\text{elas})\)</span> and yield criterion predictor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@tangent_AD</span>
    <span class="k">def</span> <span class="nf">constitutive_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="n">eps_old</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;Strain&quot;</span><span class="p">]</span>

        <span class="n">deps</span> <span class="o">=</span> <span class="n">eps</span> <span class="o">-</span> <span class="n">eps_old</span>
        <span class="n">p_old</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># convert to scalar</span>
        <span class="n">sig_old</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;Stress&quot;</span><span class="p">]</span>

        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elastic_model</span><span class="o">.</span><span class="n">C</span>
        <span class="n">sig_el</span> <span class="o">=</span> <span class="n">sig_old</span> <span class="o">+</span> <span class="n">C</span> <span class="o">@</span> <span class="n">deps</span>
        <span class="n">sig_Y_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yield_stress</span><span class="p">(</span><span class="n">p_old</span><span class="p">)</span>
        <span class="n">sig_eq_el</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equivalent_stress</span><span class="p">(</span><span class="n">sig_el</span><span class="p">),</span> <span class="n">a_min</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
        <span class="n">yield_criterion</span> <span class="o">=</span> <span class="n">sig_eq_el</span> <span class="o">-</span> <span class="n">sig_Y_old</span>
</pre></div>
</div>
<p>We define a function representing the final stress state as a function of the yet unknown plastic strain increment. To express the normality rule, we use JAX AD to compute the yield stress normal <span class="math notranslate nohighlight">\(\bn\)</span> using <code class="docutils literal notranslate"><span class="pre">jax.jacfwd</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="k">def</span> <span class="nf">stress</span><span class="p">(</span><span class="n">deps_p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sig_old</span> <span class="o">+</span> <span class="n">C</span> <span class="o">@</span> <span class="p">(</span><span class="n">deps</span> <span class="o">-</span> <span class="n">dev</span><span class="p">(</span><span class="n">deps_p</span><span class="p">))</span>

        <span class="n">normal</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jacfwd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equivalent_stress</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we set up the system of nonlinear equations to be solved at the material point level. In the plastic evolution regime, the two equations correspond to the plastic flow rule and yield condition i.e.:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
r_p ( \Delta \bepsp, \Delta p) &amp;= \bar{\sigma}(\bsig) - R(p_n+\Delta p) = 0\\
r_{\Delta\bepsp}(\Delta\bepsp, \Delta p) &amp;= \Delta\beps_p - \bn\Delta p = 0
\end{align}
\end{split}\]</div>
<p>As before, we use <code class="docutils literal notranslate"><span class="pre">jax.lax.cond</span></code> to distinguish the plastic and elastic regimes and use trivial equations <span class="math notranslate nohighlight">\(r_p=\Delta p=0\)</span> and <span class="math notranslate nohighlight">\(r_{\Delta\bepsp} = \Delta \bepsp = 0\)</span> in the elastic regime.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">JAXNewton</span></code> solver accepts a tuple of residual functions to define the system, each equation depending on the variable <span class="math notranslate nohighlight">\(x=(\Delta\bepsp, \Delta p)\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="k">def</span> <span class="nf">r_p</span><span class="p">(</span><span class="n">dx</span><span class="p">):</span>
           <span class="n">deps_p</span> <span class="o">=</span> <span class="n">dx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
           <span class="n">dp</span> <span class="o">=</span> <span class="n">dx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
           <span class="n">sig_eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equivalent_stress</span><span class="p">(</span><span class="n">stress</span><span class="p">(</span><span class="n">deps_p</span><span class="p">))</span>
           <span class="n">r_elastic</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dp</span><span class="p">:</span> <span class="n">dp</span>
           <span class="n">r_plastic</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dp</span><span class="p">:</span> <span class="n">sig_eq</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yield_stress</span><span class="p">(</span><span class="n">p_old</span> <span class="o">+</span> <span class="n">dp</span><span class="p">)</span>
           <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">yield_criterion</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">r_elastic</span><span class="p">,</span> <span class="n">r_plastic</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>

       <span class="k">def</span> <span class="nf">r_eps_p</span><span class="p">(</span><span class="n">dx</span><span class="p">):</span>
           <span class="n">deps_p</span> <span class="o">=</span> <span class="n">dx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
           <span class="n">dp</span> <span class="o">=</span> <span class="n">dx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

           <span class="n">sig</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="n">deps_p</span><span class="p">)</span>
           <span class="n">n</span> <span class="o">=</span> <span class="n">normal</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
           <span class="n">r_elastic</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">deps_p</span><span class="p">,</span> <span class="n">dp</span><span class="p">:</span> <span class="n">deps_p</span>
           <span class="n">r_plastic</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">deps_p</span><span class="p">,</span> <span class="n">dp</span><span class="p">:</span> <span class="n">deps_p</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="n">dp</span>
           <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">yield_criterion</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">r_elastic</span><span class="p">,</span> <span class="n">r_plastic</span><span class="p">,</span> <span class="n">deps_p</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>

       <span class="n">newton</span> <span class="o">=</span> <span class="n">JAXNewton</span><span class="p">((</span><span class="n">r_eps_p</span><span class="p">,</span> <span class="n">r_p</span><span class="p">))</span>
</pre></div>
</div>
<p>Finally, the local Newton system is solved (the corresponding jacobian is computed via AD) and we update the stress and internal state variables.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">x0</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">,))</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">newton</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

        <span class="n">depsp</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">sig</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="n">depsp</span><span class="p">)</span>

        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;Strain&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deps</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dp</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;Stress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span>
        <span class="k">return</span> <span class="n">sig</span><span class="p">,</span> <span class="n">state</span>
</pre></div>
</div>
<p>For an illustrative application of this behavior, see <a class="reference internal" href="demos/elastoplasticity/Hosford_yield_surface.html"><span class="std std-doc">Computing the Hosford plane stress yield surface</span></a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="jax.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">JAX implementation of material behaviors</p>
      </div>
    </a>
    <a class="right-next"
       href="demos/elastoplasticity/Hosford_yield_surface.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Computing the Hosford plane stress yield surface</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#von-mises-plasticity-with-isotropic-hardening">von Mises plasticity with isotropic hardening</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elastoplastic-evolution-equations">Elastoplastic evolution equations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#return-mapping-procedure">Return mapping procedure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jax-implementation">JAX implementation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generic-elastoplasticity-with-isotropic-hardening">Generic elastoplasticity with isotropic hardening</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jeremy Bleyer
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>